{% extends "base.html" %}

{% block title %}View Request #{{ request.id }} - ZetsuServ Admin{% endblock %}

{% block content %}
<div class="admin-view-request">
    <div class="container">
        <!-- Header -->
        <div class="request-header">
            <div class="request-title-section">
                <h1>Request #{{ request.id }}</h1>
                <span class="badge {{ request.get_status_badge_class() }}">
                    {{ request.get_status_display() }}
                </span>
            </div>
            <div class="request-actions">
                <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline">‚Üê Back to Dashboard</a>
                <form method="POST" action="{{ url_for('admin.delete_request', id=request.id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this request?');">
                    {{ form.hidden_tag() }}
                    <button type="submit" class="btn btn-danger">Delete Request</button>
                </form>
            </div>
        </div>
        
        <!-- Request Details -->
        <div class="request-detail-grid">
            <!-- Client Information -->
            <div class="detail-card">
                <h3 class="detail-card-title">Client Information</h3>
                <div class="detail-content">
                    <div class="detail-row">
                        <span class="detail-label">Name:</span>
                        <span class="detail-value">{{ request.client_name }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value"><a href="mailto:{{ request.client_email }}">{{ request.client_email }}</a></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span>
                        <span class="detail-value">{{ request.phone }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Project Information -->
            <div class="detail-card">
                <h3 class="detail-card-title">Project Information</h3>
                <div class="detail-content">
                    <div class="detail-row">
                        <span class="detail-label">Title:</span>
                        <span class="detail-value">{{ request.project_title }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Type:</span>
                        <span class="detail-value">{{ request.get_project_type_display() }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pages:</span>
                        <span class="detail-value">{{ request.pages_required }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Budget:</span>
                        <span class="detail-value">{{ request.budget }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Timestamps -->
            <div class="detail-card">
                <h3 class="detail-card-title">Timeline</h3>
                <div class="detail-content">
                    <div class="detail-row">
                        <span class="detail-label">Submitted:</span>
                        <span class="detail-value">{{ request.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Last Updated:</span>
                        <span class="detail-value">{{ request.updated_at.strftime('%Y-%m-%d %H:%M') if request.updated_at else 'Never' }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Status Update -->
            <div class="detail-card">
                <h3 class="detail-card-title">Update Status</h3>
                <div class="detail-content">
                    <form method="POST" action="{{ url_for('admin.set_status', id=request.id) }}">
                        {{ form.hidden_tag() }}
                        <div class="form-row align-items-end">
                            <div class="form-group flex-grow-1">
                                {{ form.status(class="form-control") }}
                            </div>
                            <div class="form-group">
                                {{ form.submit(class="btn btn-primary") }}
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Project Details -->
        <div class="detail-card full-width">
            <h3 class="detail-card-title">Project Details</h3>
            <div class="detail-content">
                <div class="project-details">{{ request.details }}</div>
            </div>
        </div>
        
        <!-- Uploaded Files -->
        {% if request.get_uploaded_files() %}
        <div class="detail-card full-width">
            <h3 class="detail-card-title">Uploaded Files</h3>
            <div class="detail-content">
                <div class="uploaded-files-list">
                    {% for file in request.get_uploaded_files() %}
                    <div class="uploaded-file-item">
                        <a href="{{ url_for('static', filename=file) }}" target="_blank" class="file-link">
                            {{ file.split('/')[-1] }}
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}